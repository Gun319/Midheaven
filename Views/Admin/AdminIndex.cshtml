@model Midheaven.Models.Member
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link href="~/title.ico" rel="icon" type="image/x-icon" />
    <title>AdminIndex</title>
    <link href="~/script/bootstrap.min.css" rel="stylesheet" />
    <script src="~/script/jquery-3.4.1.min.js"></script>
    <script src="~/script/bootstrap.min.js"></script>
</head>
<body>
    <div>
        <div class="nav navbar bg-secondary text-white-50 justify-content-end">
            @using (Html.BeginForm("", "", FormMethod.Post, new { @class = "mr-3" }))
            {
                <form>
                    <label class="form-inline">
                        <span>姓名：</span>@Html.TextBoxFor(m => m.RealName, new { @class = "form-control" })
                    </label>
                </form>
                <div class="mr-3">
                    <span>是否已注销:</span>
                    <label>@Html.RadioButton("flog", "0")<span>未注销</span></label>
                    <label>@Html.RadioButton("flog", "1")<span>已注销</span></label>
                    <label>@Html.RadioButton("flog", "-1", new { @checked = true })<span>全部</span></label>
                </div>
                <button type="button" id="Sel" class="btn btn-info mr-5">查询</button>
            }
        </div>
        <div class="container text-center mt-3" id="dg">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>成员编号</th>
                        <th>登录名</th>
                        <th>密码</th>
                        <th>真实姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>电话</th>
                        <th>住址</th>
                        <th>角色类型</th>
                        <th>是否已注销</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</body>
</html>

<script>
    SelInfo();

    $("#Sel").click(() => {
        SelInfo();
    });

    $("#RealName").keydown((event) => {
        SelInfo();
    })

    /**
     显示所有成员信息
     */
    function SelInfo() {
        var name = $("#RealName").val();
        var flog = $("input[type='radio']:checked").val();
        $.ajax({
            url: '/Admin/AdminIndex',
            data: { username: name, flog: flog },
            type: 'post',
            dataType: 'json',
            success: (data) => {
                var tab = "";
                $.each(data, (index, item) => {
                    tab += "<tr>";
                    tab += "<td>" + item.M_ID + "</td>";
                    tab += "<td>" + item.UserName + "</td>";
                    tab += "<td>" + item.Password + "</td>";
                    tab += "<td>" + item.RealName + "</td>";
                    tab += "<td>" + item.Sex + "</td>";
                    tab += "<td>" + item.Age + "</td>";
                    tab += "<td>" + item.PhoneNum + "</td>";
                    tab += "<td>" + item.Address + "</td>";
                    tab += "<td>" + (item.R_ID == 2 ? "教师" : "学生") + "</td>";
                    tab += "<td><button class='btn btn-primary' onclick='Edit(" + item.M_ID + ")'>" + (item.M_Flog == 0 ? "未注销" : "已注销") + "</button></td>";
                    tab += "<td><button type='button' class='btn btn-danger' onclick='Del(" + item.M_ID + ")'>删除</button>";
                    tab += "</tr>";
                })
                $("#dg tbody tr").remove();
                $("#dg tbody").append(tab);
            }
        });
    }

    /**
     更改成员注销状态
     */
    function Edit(mid) {
        $.ajax({
            url: '/Admin/Editflag',
            data: { mid: mid },
            type: 'post',
            dataType: 'json',
            success: (data) => {
                if (data == 200) {
                    SelInfo();
                } else {
                    alert('修改失败，请检查网络连接');
                }
            }
        });
    }

    /**
     真是删除成员信息
     */
    function Del(mid) {
        $.ajax({
            url: '/Admin/DelMemberByCID',
            data: { mid: mid },
            type: 'post',
            dataType: 'json',
            success: (data) => {
                if (data == 200) {
                    alert('删除成功');
                    SelInfo();
                } else {
                    alert('删除失败，请检查网络连接');
                }
            }
        });
    }
</script>
